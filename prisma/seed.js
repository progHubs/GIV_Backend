const { PrismaClient } = require('../src/generated/prisma');
const { hashPassword } = require('../src/utils/password.util');

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Starting database seeding...');

  try {
    // Clear existing data (optional - comment out if you want to keep existing data)
    console.log('üßπ Clearing existing data...');
    await prisma.volunteer_skills.deleteMany();
    await prisma.event_participants.deleteMany();
    await prisma.posts.deleteMany();
    await prisma.events.deleteMany();
    await prisma.skills.deleteMany();
    await prisma.volunteer_profiles.deleteMany();
    await prisma.donor_profiles.deleteMany();
    await prisma.users.deleteMany();

    console.log('‚úÖ Existing data cleared');

    // Create users
    console.log('üë• Creating users...');
    const users = await Promise.all([
      prisma.users.create({
        data: {
          full_name: 'Admin User',
          email: 'admin@givsociety.org',
          phone: '+251911234567',
          password_hash: await hashPassword('Admin123!'),
          role: 'admin',
          profile_image_url: 'https://example.com/admin.jpg',
          language_preference: 'en',
          email_verified: true
        }
      }),
      prisma.users.create({
        data: {
          full_name: 'John Doe',
          email: 'john.doe@example.com',
          phone: '+251922345678',
          password_hash: await hashPassword('Volunteer123!'),
          role: 'volunteer',
          profile_image_url: 'https://example.com/john.jpg',
          language_preference: 'en',
          email_verified: true
        }
      }),
      prisma.users.create({
        data: {
          full_name: 'Sarah Smith',
          email: 'sarah.smith@example.com',
          phone: '+251933456789',
          password_hash: await hashPassword('Donor123!'),
          role: 'donor',
          profile_image_url: 'https://example.com/sarah.jpg',
          language_preference: 'en',
          email_verified: true
        }
      }),
      prisma.users.create({
        data: {
          full_name: 'Editor User',
          email: 'editor@givsociety.org',
          phone: '+251944567890',
          password_hash: await hashPassword('Editor123!'),
          role: 'editor',
          profile_image_url: 'https://example.com/editor.jpg',
          language_preference: 'en',
          email_verified: true
        }
      }),
      prisma.users.create({
        data: {
          full_name: '·â∞·ã∞·àõ·à™ ·ä†·â†·â†',
          email: 'tadesse.abebe@example.com',
          phone: '+251955678901',
          password_hash: await hashPassword('Amharic123!'),
          role: 'volunteer',
          profile_image_url: 'https://example.com/tadesse.jpg',
          language_preference: 'am',
          email_verified: true
        }
      })
    ]);

    console.log(`‚úÖ Created ${users.length} users`);

    // Create skills
    console.log('üõ†Ô∏è Creating skills...');
    const skills = await Promise.all([
      prisma.skills.create({
        data: {
          name: 'Medical Care',
          category: 'Healthcare',
          description: 'Basic medical care and first aid skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Teaching',
          category: 'Education',
          description: 'Teaching and educational support skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Event Planning',
          category: 'Management',
          description: 'Event planning and coordination skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Translation',
          category: 'Language',
          description: 'Amharic-English translation skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Photography',
          category: 'Media',
          description: 'Photography and documentation skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Fundraising',
          category: 'Finance',
          description: 'Fundraising and donor relations skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Counseling',
          category: 'Mental Health',
          description: 'Mental health counseling and support skills'
        }
      }),
      prisma.skills.create({
        data: {
          name: 'Youth Mentoring',
          category: 'Youth Development',
          description: 'Youth mentoring and guidance skills'
        }
      })
    ]);

    console.log(`‚úÖ Created ${skills.length} skills`);

    // Create events
    console.log('üìÖ Creating events...');
    const events = await Promise.all([
      prisma.events.create({
        data: {
          title: 'Medical Outreach Program',
          slug: 'medical-outreach-2024',
          description: 'Free medical checkup and consultation for underserved communities',
          event_date: new Date('2024-07-15'),
          event_time: new Date('2024-07-15T09:00:00'),
          timezone: 'Africa/Addis_Ababa',
          location: 'Addis Ababa Community Center',
          latitude: 9.0320,
          longitude: 38.7636,
          category: 'Healthcare',
          capacity: 100,
          registered_count: 0,
          status: 'upcoming',
          registration_deadline: new Date('2024-07-10'),
          registration_link: 'https://forms.example.com/medical-outreach',
          agenda: '9:00 AM - Registration\n10:00 AM - Medical Checkups\n2:00 PM - Health Education\n4:00 PM - Closing',
          speaker_info: JSON.stringify([
            { name: 'Dr. Alemayehu Bekele', specialty: 'General Medicine' },
            { name: 'Dr. Bethlehem Tadesse', specialty: 'Pediatrics' }
          ]),
          requirements: 'Volunteers should have basic medical training or be willing to assist with registration and logistics',
          ticket_price: 0.00,
          is_featured: true,
          created_by: users[0].id, // Admin user
          language: 'en'
        }
      }),
      prisma.events.create({
        data: {
          title: 'Youth Leadership Workshop',
          slug: 'youth-leadership-workshop-2024',
          description: 'Empowering young leaders with essential leadership and communication skills',
          event_date: new Date('2024-08-20'),
          event_time: new Date('2024-08-20T14:00:00'),
          timezone: 'Africa/Addis_Ababa',
          location: 'Youth Center, Addis Ababa',
          latitude: 9.0320,
          longitude: 38.7636,
          category: 'Youth Development',
          capacity: 50,
          registered_count: 0,
          status: 'upcoming',
          registration_deadline: new Date('2024-08-15'),
          registration_link: 'https://forms.example.com/youth-leadership',
          agenda: '2:00 PM - Welcome and Introduction\n3:00 PM - Leadership Skills Session\n4:30 PM - Group Activities\n6:00 PM - Networking',
          speaker_info: JSON.stringify([
            { name: 'Ato Yohannes Haile', expertise: 'Leadership Development' },
            { name: 'W/ro Kidist Mamo', expertise: 'Youth Empowerment' }
          ]),
          requirements: 'Open to youth aged 18-25. No prior experience required.',
          ticket_price: 0.00,
          is_featured: false,
          created_by: users[3].id, // Editor user
          language: 'en'
        }
      }),
      prisma.events.create({
        data: {
          title: 'Mental Health Awareness Seminar',
          slug: 'mental-health-awareness-2024',
          description: 'Raising awareness about mental health and providing support resources',
          event_date: new Date('2024-09-10'),
          event_time: new Date('2024-09-10T10:00:00'),
          timezone: 'Africa/Addis_Ababa',
          location: 'Mental Health Center, Addis Ababa',
          latitude: 9.0320,
          longitude: 38.7636,
          category: 'Mental Health',
          capacity: 75,
          registered_count: 0,
          status: 'upcoming',
          registration_deadline: new Date('2024-09-05'),
          registration_link: 'https://forms.example.com/mental-health',
          agenda: '10:00 AM - Introduction to Mental Health\n11:30 AM - Common Mental Health Issues\n1:00 PM - Lunch Break\n2:00 PM - Support Resources\n3:30 PM - Q&A Session',
          speaker_info: JSON.stringify([
            { name: 'Dr. Selamawit Gebre', specialty: 'Psychiatry' },
            { name: 'Ato Dawit Mengistu', specialty: 'Clinical Psychology' }
          ]),
          requirements: 'Open to all. Mental health professionals and community members welcome.',
          ticket_price: 0.00,
          is_featured: true,
          created_by: users[1].id, // John Doe (volunteer)
          language: 'en'
        }
      }),
      prisma.events.create({
        data: {
          title: '·ã®·å§·äì ·ä†·åà·àç·åç·àé·âµ ·çï·àÆ·åç·à´·àù',
          slug: 'health-service-program-amharic',
          description: '·ã®·å§·äì ·ä†·åà·àç·åç·àé·âµ ·ä•·äì ·ã®·àò·åÄ·àò·à™·ã´ ·ã∞·à®·åÉ ·ãµ·åã·çç ·àà·àõ·àÖ·â†·à®·à∞·â°',
          event_date: new Date('2024-07-25'),
          event_time: new Date('2024-07-25T08:00:00'),
          timezone: 'Africa/Addis_Ababa',
          location: '·ã®·àõ·àÖ·â†·à®·à∞·â• ·àõ·ãï·ä®·àç, ·ä†·ã≤·àµ ·ä†·â†·â£',
          latitude: 9.0320,
          longitude: 38.7636,
          category: 'Healthcare',
          capacity: 80,
          registered_count: 0,
          status: 'upcoming',
          registration_deadline: new Date('2024-07-20'),
          registration_link: 'https://forms.example.com/health-amharic',
          agenda: '8:00 ·å•·ãã·âµ - ·àù·ãù·åà·â£\n9:00 ·å•·ãã·âµ - ·ã®·å§·äì ·àù·à≠·àò·à´\n12:00 ·âÄ·äï - ·ã®·å§·äì ·âµ·àù·àÖ·à≠·âµ\n2:00 ·âÄ·äï - ·àò·ã∞·àù·ã∞·àö·ã´',
          speaker_info: JSON.stringify([
            { name: '·ã∂/·à≠ ·ä†·àà·àõ·ã®·àÅ ·â†·âÄ·àà', specialty: '·ä†·å†·âÉ·àã·ã≠ ·àê·ä™·àù' },
            { name: '·ã∂/·à≠ ·â§·â∞·àç·àÑ·àù ·â≥·ã∞·à∞', specialty: '·ã®·àÖ·çÉ·äì·âµ ·àê·ä™·àù' }
          ]),
          requirements: '·ã®·å§·äì ·à∞·å™·ãé·âΩ ·àò·à∞·à®·â≥·ãä ·ã®·å§·äì ·àµ·àç·å†·äì ·àä·äñ·à´·â∏·ãç ·ã≠·åà·â£·àç',
          ticket_price: 0.00,
          is_featured: false,
          created_by: users[4].id, // Tadesse Abebe (Amharic user)
          language: 'am'
        }
      })
    ]);

    console.log(`‚úÖ Created ${events.length} events`);

    // Create posts
    console.log('üìù Creating posts...');
    const posts = await Promise.all([
      prisma.posts.create({
        data: {
          title: 'GIV Society Launches New Medical Outreach Program',
          slug: 'giv-society-medical-outreach-launch',
          content: `GIV Society is excited to announce the launch of our comprehensive medical outreach program aimed at serving underserved communities in Ethiopia.

Our new initiative will provide:
- Free medical checkups
- Health education workshops
- Access to basic medications
- Referrals to specialized care

The program will begin in July 2024 and will initially focus on communities in Addis Ababa, with plans to expand to other regions.

"We believe that access to quality healthcare is a fundamental human right," says Dr. Alemayehu Bekele, our medical director. "This program represents our commitment to making healthcare accessible to all Ethiopians."

To volunteer or support this program, please contact us at volunteer@givsociety.org or make a donation through our website.`,
          post_type: 'news',
          author_id: users[0].id, // Admin user
          feature_image: 'https://example.com/medical-outreach.jpg',
          language: 'en'
        }
      }),
      prisma.posts.create({
        data: {
          title: 'The Impact of Mental Health Support in Our Community',
          slug: 'mental-health-support-impact',
          content: `Mental health is a critical component of overall well-being, yet it remains one of the most overlooked aspects of healthcare in many communities.

At GIV Society, we've seen firsthand the transformative impact that mental health support can have on individuals and families. Our recent mental health awareness programs have reached over 500 people, providing them with:

- Information about common mental health conditions
- Coping strategies and self-care techniques
- Access to professional counseling services
- Support group connections

The stigma surrounding mental health is slowly being reduced as more people become aware of the importance of mental well-being. Our volunteers have reported significant improvements in the communities they serve.

"Mental health support isn't just about treating conditions," explains our mental health coordinator, Dr. Selamawit Gebre. "It's about creating a supportive environment where people feel safe to seek help and support each other."

We encourage everyone to participate in our upcoming mental health awareness seminar on September 10th, 2024.`,
          post_type: 'blog',
          author_id: users[1].id, // John Doe (volunteer)
          feature_image: 'https://example.com/mental-health.jpg',
          language: 'en'
        }
      }),
      prisma.posts.create({
        data: {
          title: 'Youth Empowerment: Building Tomorrow\'s Leaders',
          slug: 'youth-empowerment-leadership',
          content: `Investing in youth is investing in the future. Our youth development programs focus on empowering young people with the skills, confidence, and opportunities they need to become effective leaders.

Through our various initiatives, we've helped hundreds of young people develop:

- Leadership and communication skills
- Critical thinking and problem-solving abilities
- Community engagement and social responsibility
- Professional development and career guidance

Our youth leadership workshop, scheduled for August 20th, 2024, will bring together young leaders from across Ethiopia to share experiences and learn from each other.

"The energy and enthusiasm of our young participants is truly inspiring," says Ato Yohannes Haile, our youth programs coordinator. "They are not just the leaders of tomorrow; they are making a difference today."

We believe that every young person has the potential to be a leader. Our programs provide the platform and support they need to realize that potential.`,
          post_type: 'blog',
          author_id: users[3].id, // Editor user
          feature_image: 'https://example.com/youth-leadership.jpg',
          language: 'en'
        }
      }),
      prisma.posts.create({
        data: {
          title: '·ã®·å§·äì ·ä†·åà·àç·åç·àé·âµ ·çï·àÆ·åç·à´·àù ·àò·åÄ·àò·à™·ã´',
          slug: 'health-service-program-amharic-post',
          content: `GIV Society ·ä†·ã≤·àµ ·ã®·å§·äì ·ä†·åà·àç·åç·àé·âµ ·çï·àÆ·åç·à´·àù ·ä•·äï·ã∞·åÄ·àò·à® ·àà·àõ·àÖ·â†·à®·à∞·â° ·àõ·àµ·â≥·ãà·âÇ·ã´ ·ä•·äï·ã∞·à∞·å† ·ä•·äì·ãç·âÉ·àà·äï·ç¢

·ã≠·àÖ ·çï·àÆ·åç·à´·àù ·ã®·àö·ä®·â∞·àâ·âµ·äï ·ã´·ä´·âµ·â≥·àç:
- ·äê·çÉ ·ã®·å§·äì ·àù·à≠·àò·à´
- ·ã®·å§·äì ·âµ·àù·àÖ·à≠·âµ ·àµ·àç·å†·äì·ãé·âΩ
- ·àò·à∞·à®·â≥·ãä ·àò·ãµ·àÉ·äí·â∂·âΩ ·àõ·åç·äò·âµ
- ·àà·àµ·çî·àª·àä·àµ·âµ ·ä•·à≠·ã≥·â≥ ·àõ·å£·âÄ·àª

·çï·àÆ·åç·à´·àô ·â†·åÅ·àã·ã≠ 2024 ·ã≠·åÄ·àù·à´·àç ·ä•·äì ·àò·åÄ·àò·à™·ã´ ·àã·ã≠ ·â†·ä†·ã≤·àµ ·ä†·â†·â£ ·àõ·àÖ·â†·à®·à∞·â¶·âΩ ·àã·ã≠ ·ã´·â∞·ä©·à´·àç·ç¢

"·ã®·å•·à´·âµ ·ã´·àà·ãç ·ã®·å§·äì ·ä†·åà·àç·åç·àé·âµ ·àò·ãµ·à®·àµ ·àò·à∞·à®·â≥·ãä ·ã®·à∞·ãç ·à∞·ãç ·àò·â•·âµ ·äê·ãç ·â•·àà·äï ·ä•·äì·àù·äì·àà·äï" ·ã®·àö·àà·ãç ·ã∂/·à≠ ·ä†·àà·àõ·ã®·àÅ ·â†·âÄ·àà·ç£ ·ã®·ä•·äõ ·ã®·å§·äì ·ã≥·ã≠·à¨·ä≠·â∞·à≠·ç¢

·ã≠·àÖ·äï ·çï·àÆ·åç·à´·àù ·àà·àò·ã∞·åà·çç ·ãà·ã≠·àù ·àà·àò·àµ·à´·âµ ·ä•·â£·ä≠·ãé ·ä•·äõ·äï ·ã´·åç·äô·ç¢`,
          post_type: 'news',
          author_id: users[4].id, // Tadesse Abebe (Amharic user)
          feature_image: 'https://example.com/health-amharic.jpg',
          language: 'am'
        }
      })
    ]);

    console.log(`‚úÖ Created ${posts.length} posts`);

    // Create volunteer profiles for volunteer users
    console.log('üë®‚Äç‚öïÔ∏è Creating volunteer profiles...');
    const volunteerProfiles = await Promise.all([
      prisma.volunteer_profiles.create({
        data: {
          user_id: users[1].id, // John Doe
          area_of_expertise: 'Healthcare',
          location: 'Addis Ababa',
          availability: JSON.stringify({
            weekdays: ['Monday', 'Wednesday', 'Friday'],
            weekends: ['Saturday'],
            hours: '9:00 AM - 5:00 PM'
          }),
          motivation: 'I want to help improve healthcare access for underserved communities in Ethiopia.',
          total_hours: 120,
          certificate_url: 'https://example.com/certificates/john-doe.pdf',
          registered_events_count: 5,
          training_completed: true,
          background_check_status: 'approved',
          emergency_contact_name: 'Jane Doe',
          emergency_contact_phone: '+251911234568',
          rating: 4.8
        }
      }),
      prisma.volunteer_profiles.create({
        data: {
          user_id: users[4].id, // Tadesse Abebe
          area_of_expertise: 'Translation',
          location: 'Addis Ababa',
          availability: JSON.stringify({
            weekdays: ['Tuesday', 'Thursday'],
            weekends: ['Sunday'],
            hours: '10:00 AM - 6:00 PM'
          }),
          motivation: 'I want to help bridge the language gap and make services accessible to Amharic speakers.',
          total_hours: 80,
          certificate_url: 'https://example.com/certificates/tadesse-abebe.pdf',
          registered_events_count: 3,
          training_completed: true,
          background_check_status: 'approved',
          emergency_contact_name: '·à∞·äì·ã≠·âµ ·ä†·â†·â†',
          emergency_contact_phone: '+251922345679',
          rating: 4.9
        }
      })
    ]);

    console.log(`‚úÖ Created ${volunteerProfiles.length} volunteer profiles`);

    // Create donor profiles for donor users
    console.log('üí∞ Creating donor profiles...');
    const donorProfiles = await Promise.all([
      prisma.donor_profiles.create({
        data: {
          user_id: users[2].id, // Sarah Smith
          is_recurring_donor: true,
          preferred_payment_method: 'Credit Card',
          total_donated: 2500.00,
          donation_frequency: 'monthly',
          tax_receipt_email: 'sarah.smith@example.com',
          is_anonymous: false,
          last_donation_date: new Date('2024-06-15'),
          donation_tier: 'gold'
        }
      })
    ]);

    console.log(`‚úÖ Created ${donorProfiles.length} donor profiles`);

    // Create volunteer skills relationships
    console.log('üîó Creating volunteer skills...');
    const volunteerSkills = await Promise.all([
      prisma.volunteer_skills.create({
        data: {
          volunteer_id: users[1].id, // John Doe
          skill_id: skills[0].id, // Medical Care
          proficiency_level: 'expert',
          is_verified: true
        }
      }),
      prisma.volunteer_skills.create({
        data: {
          volunteer_id: users[1].id, // John Doe
          skill_id: skills[2].id, // Event Planning
          proficiency_level: 'intermediate',
          is_verified: true
        }
      }),
      prisma.volunteer_skills.create({
        data: {
          volunteer_id: users[4].id, // Tadesse Abebe
          skill_id: skills[3].id, // Translation
          proficiency_level: 'expert',
          is_verified: true
        }
      }),
      prisma.volunteer_skills.create({
        data: {
          volunteer_id: users[4].id, // Tadesse Abebe
          skill_id: skills[1].id, // Teaching
          proficiency_level: 'intermediate',
          is_verified: true
        }
      })
    ]);

    console.log(`‚úÖ Created ${volunteerSkills.length} volunteer skills`);

    // Create event participants
    console.log('üìã Creating event participants...');
    const eventParticipants = await Promise.all([
      prisma.event_participants.create({
        data: {
          event_id: events[0].id, // Medical Outreach Program
          user_id: users[1].id, // John Doe
          role: 'volunteer',
          status: 'confirmed'
        }
      }),
      prisma.event_participants.create({
        data: {
          event_id: events[0].id, // Medical Outreach Program
          user_id: users[4].id, // Tadesse Abebe
          role: 'volunteer',
          status: 'confirmed'
        }
      }),
      prisma.event_participants.create({
        data: {
          event_id: events[1].id, // Youth Leadership Workshop
          user_id: users[1].id, // John Doe
          role: 'attendee',
          status: 'registered'
        }
      }),
      prisma.event_participants.create({
        data: {
          event_id: events[2].id, // Mental Health Awareness Seminar
          user_id: users[2].id, // Sarah Smith
          role: 'attendee',
          status: 'registered'
        }
      })
    ]);

    console.log(`‚úÖ Created ${eventParticipants.length} event participants`);

    console.log('üéâ Database seeding completed successfully!');
    console.log('\nüìä Summary:');
    console.log(`- ${users.length} users created`);
    console.log(`- ${skills.length} skills created`);
    console.log(`- ${events.length} events created`);
    console.log(`- ${posts.length} posts created`);
    console.log(`- ${volunteerProfiles.length} volunteer profiles created`);
    console.log(`- ${donorProfiles.length} donor profiles created`);
    console.log(`- ${volunteerSkills.length} volunteer skills created`);
    console.log(`- ${eventParticipants.length} event participants created`);

  } catch (error) {
    console.error('‚ùå Error during seeding:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

main()
  .then(async () => {
    console.log('‚úÖ Seeding completed');
    process.exit(0);
  })
  .catch(async (e) => {
    console.error('‚ùå Seeding failed:', e);
    process.exit(1);
  });
