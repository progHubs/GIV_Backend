<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Upload Test</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .upload-section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
      }
      .preview-image {
        max-width: 200px;
        max-height: 200px;
        margin-top: 1rem;
      }
      .response-area {
        margin-top: 1rem;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        min-height: 100px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">File Upload Test</h1>

      <!-- Image Upload -->
      <div class="upload-section">
        <h3>Image Upload</h3>
        <form id="imageForm" class="mb-3">
          <div class="mb-3">
            <label for="image" class="form-label">Select Image</label>
            <input
              type="file"
              class="form-control"
              id="image"
              name="image"
              accept="image/*"
            />
          </div>
          <button type="submit" class="btn btn-primary">Upload Image</button>
        </form>
        <div id="imagePreview"></div>
        <div id="imageResponse" class="response-area"></div>
      </div>

      <!-- Document Upload -->
      <div class="upload-section">
        <h3>Document Upload</h3>
        <form id="documentForm" class="mb-3">
          <div class="mb-3">
            <label for="document" class="form-label">Select Document</label>
            <input
              type="file"
              class="form-control"
              id="document"
              name="document"
              accept=".pdf,.doc,.docx"
            />
          </div>
          <button type="submit" class="btn btn-primary">Upload Document</button>
        </form>
        <div id="documentResponse" class="response-area"></div>
      </div>

      <!-- Spreadsheet Upload -->
      <div class="upload-section">
        <h3>Spreadsheet Upload</h3>
        <form id="spreadsheetForm" class="mb-3">
          <div class="mb-3">
            <label for="spreadsheet" class="form-label"
              >Select Spreadsheet</label
            >
            <input
              type="file"
              class="form-control"
              id="spreadsheet"
              name="spreadsheet"
              accept=".xlsx,.xls,.csv"
            />
          </div>
          <button type="submit" class="btn btn-primary">
            Upload Spreadsheet
          </button>
        </form>
        <div id="spreadsheetResponse" class="response-area"></div>
      </div>

      <!-- Video Upload -->
      <div class="upload-section">
        <h3>Video Upload</h3>
        <form id="videoForm" class="mb-3">
          <div class="mb-3">
            <label for="video" class="form-label">Select Video</label>
            <input
              type="file"
              class="form-control"
              id="video"
              name="video"
              accept="video/*"
            />
          </div>
          <button type="submit" class="btn btn-primary">Upload Video</button>
        </form>
        <div id="videoPreview"></div>
        <div id="videoResponse" class="response-area"></div>
      </div>

      <!-- Audio Upload -->
      <div class="upload-section">
        <h3>Audio Upload</h3>
        <form id="audioForm" class="mb-3">
          <div class="mb-3">
            <label for="audio" class="form-label">Select Audio</label>
            <input
              type="file"
              class="form-control"
              id="audio"
              name="audio"
              accept="audio/*"
            />
          </div>
          <button type="submit" class="btn btn-primary">Upload Audio</button>
        </form>
        <div id="audioPreview"></div>
        <div id="audioResponse" class="response-area"></div>
      </div>
    </div>

    <script>
      // Helper function to handle file uploads
      async function handleUpload(formId, endpoint) {
        const form = document.getElementById(formId);
        const responseArea = document.getElementById(
          formId.replace("Form", "Response")
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(form);

          try {
            responseArea.innerHTML = "Uploading...";
            const response = await fetch(endpoint, {
              method: "POST",
              body: formData,
            });

            const result = await response.json();
            if (response.ok) {
              responseArea.innerHTML = `
                            <div class="alert alert-success">
                                Upload successful!<br>
                                URL: <a href="${result.data.url}" target="_blank">${result.data.url}</a><br>
                                Public ID: ${result.data.public_id}
                            </div>
                        `;

              // Preview for images and videos
              const previewArea = document.getElementById(
                formId.replace("Form", "Preview")
              );
              if (previewArea) {
                if (endpoint.includes("image")) {
                  previewArea.innerHTML = `<img src="${result.data.url}" class="preview-image">`;
                } else if (endpoint.includes("video")) {
                  previewArea.innerHTML = `
                                    <video controls class="preview-image">
                                        <source src="${result.data.url}" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                `;
                } else if (endpoint.includes("audio")) {
                  previewArea.innerHTML = `
                                    <audio controls>
                                        <source src="${result.data.url}" type="audio/mpeg">
                                        Your browser does not support the audio tag.
                                    </audio>
                                `;
                }
              }
            } else {
              throw new Error(result.error || "Upload failed");
            }
          } catch (error) {
            responseArea.innerHTML = `
                        <div class="alert alert-danger">
                            Error: ${error.message}
                        </div>
                    `;
          }
        });
      }

      // Initialize upload handlers
      handleUpload("imageForm", "/upload/image");
      handleUpload("documentForm", "/upload/document");
      handleUpload("spreadsheetForm", "/upload/spreadsheet");
      handleUpload("videoForm", "/upload/video");
      handleUpload("audioForm", "/upload/audio");
    </script>
  </body>
</html>
